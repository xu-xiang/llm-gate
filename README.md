# llm-gate (Research & Observability)

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªä¸“æ³¨äº **LLM æ¥å£åè®®è½¬æ¢**ä¸**æœåŠ¡å¯è§‚æµ‹æ€§**çš„æŠ€æœ¯ç ”ç©¶é¡¹ç›®ã€‚é€šè¿‡æ ‡å‡†åŒ–çš„åè®®æ¡¥æ¥ï¼Œå®ç°å¯¹å¼‚æ„æ¨¡å‹æ¥å£å“åº”ç‰¹æ€§çš„æ·±åº¦è§‚æµ‹ã€‚

![Dashboard UI](images/ui.png)
*æç®€ä¸»ä¹‰é£æ ¼çš„å®æ—¶è§‚æµ‹ä»ªè¡¨ç›˜*

> [!IMPORTANT]
> **å…è´£ä¸åˆè§„ä½¿ç”¨å£°æ˜ (Exemption & Compliance Statement)**ï¼š
> 
> 1. **ç ”ç©¶å®šä½**ï¼šæœ¬é¡¹ç›®ï¼ˆLLM Protocol Bridgeï¼‰ä»…ä½œä¸º **æ¥å£åè®®æ¡¥æ¥** ä¸ **å¯è§‚æµ‹æ€§ç®—æ³•** çš„æŠ€æœ¯ç ”ç©¶æ–¹æ¡ˆã€‚å…¶æ ¸å¿ƒé€»è¾‘åœ¨äºæ¢è®¨å¦‚ä½•å®ç°å¼‚æ„åè®®é—´çš„è¯­ä¹‰å¯¹é½ï¼Œä¸¥ç¦å°†æœ¬é¡¹ç›®ç”¨äºä»»ä½•è¿åæ³•å¾‹æ³•è§„æˆ–æœåŠ¡æä¾›å•†æ”¿ç­–çš„è¡Œä¸ºã€‚
> 2. **åˆè§„ä¹‰åŠ¡**ï¼šä½¿ç”¨è€…åœ¨è¿è¡Œæœ¬é¡¹ç›®å‰ï¼Œ**å¿…é¡»è‡ªè¡Œé€šè¿‡å®˜æ–¹åˆè§„æ¸ é“è·å–ç›¸å…³æˆæƒå‡­è¯**ï¼ˆå¦‚ OAuth å®¢æˆ·ç«¯æƒé™ï¼‰ã€‚æœ¬é¡¹ç›®ä¸æä¾›ä»»ä½•å½¢å¼çš„è´¦å·ã€Tokenã€ç»•è¿‡å·¥å…·æˆ–éæ³•æ¥å…¥é€”å¾„ã€‚
> 3. **è¡Œä¸ºè¾¹ç•Œ**ï¼šä½¿ç”¨è€…åº”ä¸¥æ ¼éµå®ˆå¯¹åº”æœåŠ¡å•†çš„ã€Šå¼€å‘è€…ä½¿ç”¨è§„èŒƒã€‹åŠã€ŠæœåŠ¡æ¡æ¬¾ã€‹ã€‚ä¸¥ç¦åˆ©ç”¨æœ¬é¡¹ç›®è¿›è¡Œä»»ä½•å¯èƒ½å¯¼è‡´ä¸Šæ¸¸èµ„æºè´Ÿè½½å¼‚å¸¸ã€å¹²æ‰°æœåŠ¡è¿è¡Œæˆ–ä¾µçŠ¯ä»–äººæƒç›Šçš„æ“ä½œã€‚
> 4. **å…è´£æ¡æ¬¾**ï¼š
>    - ä½œä¸ºå¼€æºæŠ€æœ¯æ–¹æ¡ˆï¼Œæœ¬é¡¹ç›®æŒ‰â€œåŸæ ·â€æä¾›ï¼Œä¸é™„å¸¦ä»»ä½•æ˜ç¤ºæˆ–æš—ç¤ºçš„ä¿è¯ã€‚
>    - ä½¿ç”¨è€…å› è¿åç›¸å…³åè®®æˆ–ä¸å½“æ“ä½œæ‰€å¯¼è‡´çš„ä»»ä½•åæœï¼ˆåŒ…æ‹¬ä½†ä¸é™äºè´¦å·å—é™ã€æ³•å¾‹çº çº·æˆ–ç»æµæŸå¤±ï¼‰ï¼Œ**å‡ç”±ä½¿ç”¨è€…æœ¬äººæ‰¿æ‹…å…¨éƒ¨è´£ä»»**ï¼Œæœ¬é¡¹ç›®ä½œè€…åŠè´¡çŒ®è€…å¯¹æ­¤ä¸æ‰¿æ‹…ä»»ä½•è¿å¸¦è´£ä»»ã€‚
>    - æœ¬é¡¹ç›®çš„å­˜åœ¨ä¸ä»£è¡¨å¯¹ä»»ä½•ä¸Šæ¸¸æœåŠ¡çš„ä»»ä½•å½¢å¼çš„èƒŒä¹¦æˆ–å…³è”ã€‚
> 
> **ä¸€æ—¦ä½¿ç”¨æœ¬é¡¹ç›®ï¼Œå³è§†ä¸ºæ‚¨å·²å®Œå…¨ç†è§£å¹¶æ¥å—ä¸Šè¿°æ‰€æœ‰æ¡æ¬¾ã€‚**

## ğŸ”¬ æŠ€æœ¯ç ”ç©¶ç»´åº¦

- **è¯­ä¹‰åè®®æ˜ å°„éªŒè¯**ï¼šç ”ç©¶å¦‚ä½•å°†ä¸åŒå‚å•†çš„è¯­ä¹‰æ ‡è¯†ï¼ˆModel Aliasingï¼‰è½¬æ¢ä¸ºæ ‡å‡†åŒ–æ¥å£ã€‚
- **OAuth äº¤äº’æµç¨‹è‡ªåŠ¨åŒ–**ï¼šæ¢ç´¢é’ˆå¯¹ Device Flow æˆæƒæ¨¡å¼çš„éé˜»å¡å¼èº«ä»½éªŒè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚
- **ç«¯ç‚¹å¥åº·æ„ŸçŸ¥é€»è¾‘**ï¼šæ¢è®¨åœ¨å¤šç«¯ç‚¹ç¯å¢ƒä¸‹éªŒè¯æ•…éšœè½¬ç§»ä¸è´Ÿè½½åˆ†å‘ç­–ç•¥çš„æœ‰æ•ˆæ€§ã€‚

## ğŸ” èº«ä»½éªŒè¯ä¸å‡­æ®ç®¡ç†

é¡¹ç›®æ”¯æŒä¸¤ç§å‡­æ®åŠ è½½æ–¹å¼ï¼Œç¡®ä¿ç ”ç©¶ç¯å¢ƒçš„çµæ´»é…ç½®ï¼š

### 1. ä½¿ç”¨å·²æœ‰å‡­æ®
åœ¨ `gateway.yaml` çš„ `auth_files` åˆ—è¡¨ä¸­æŒ‡å®šå·²å­˜åœ¨çš„ `.json` è·¯å¾„ï¼Œç³»ç»Ÿå°†ç›´æ¥åŠ è½½ã€‚

### 2. äº¤äº’å¼æˆæƒç”Ÿæˆ
è‹¥æŒ‡å®šçš„è·¯å¾„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¯åŠ¨ **OAuth Device Flow** æµç¨‹ã€‚æ‚¨åªéœ€æ ¹æ®ç»ˆç«¯æç¤ºæ“ä½œï¼š

```text
[INFO] Verifying token with active API check...

==================================================
      Qwen API Gateway Authentication Required
==================================================
Target File: ./oauth_creds_research.json

1. Open this URL in your browser:
   https://chat.qwen.ai/authorize?user_code=CS-9UA0P&client=qwen-code

2. Verify the code matches:
   CS-9UA0P

Waiting for you to approve in the browser...
==================================================
```
æˆæƒå®Œæˆåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨æŒ‡å®šè·¯å¾„ç”Ÿæˆå¯¹åº”çš„åŠ å¯†å‡­æ®æ–‡ä»¶ã€‚

### OAuth å®¢æˆ·ç«¯ ID é…ç½®

é¡¹ç›®é»˜è®¤ä½¿ç”¨ **qwen-code çš„ OAuth client_id**ï¼Œä¸å®˜æ–¹å®¢æˆ·ç«¯ä¿æŒä¸€è‡´ï¼Œä½ç½®å‚è€ƒï¼š`packages/core/src/qwen/qwenOAuth2.ts`ã€‚
å¦‚æœªæ¥è¯¥å€¼å‘ç”Ÿå˜åŒ–ï¼Œå¯åœ¨ `gateway.yaml` ä¸­è¦†ç›–ï¼š

```yaml
qwen_oauth_client_id: f0304373b74a44d2b584a3fb70ca9e56
```

> è¯´æ˜ï¼šè¯¥å€¼ä»…ç”¨äº OAuth Device Flow çš„å®¢æˆ·ç«¯æ ‡è¯†ï¼Œä¸åŒ…å«å¯†é’¥ã€‚

## ğŸ§© æ”¯æŒçŠ¶æ€ä¸è·¯çº¿å›¾

- [x] **Qwen åè®®é€‚é…æ¨¡å—**ï¼šé’ˆå¯¹ç‰¹å®š OAuth æµç¨‹çš„æ¥å£è½¬æ¢ä¸è§‚æµ‹éªŒè¯ã€‚
- [ ] **Gemini åè®®é€‚é…æ¨¡å—**ï¼š*è§„åˆ’ä¸­*ã€‚
- [ ] **é€šç”¨æ ‡å‡†åŒ–æ¡†æ¶**ï¼š*è§„åˆ’ä¸­*ã€‚

## ğŸš€ è¿è¡Œä¸è°ƒè¯•

### 1. ä¾èµ–æ„å»º
```bash
npm install
npm run build
```

### 2. å¯åŠ¨ç ”ç©¶ç¯å¢ƒ
```bash
./bin/restart.sh
```
å¯åŠ¨åè®¿é—® `http://localhost:3000` å³å¯è¿›å…¥æç®€è§‚æµ‹å°ã€‚

## ğŸ” Web Search æ¥å£ï¼ˆDashScope / Qwen OAuthï¼‰

Web Search é€šè¿‡ Qwen OAuth çš„ DashScope æœç´¢èƒ½åŠ›è½¬å‘ï¼Œæä¾›ç»Ÿä¸€çš„å·¥å…·æ¥å£ï¼š

**æ¥å£åœ°å€**
```
POST /v1/tools/web_search
```

**è¯·æ±‚ä½“**
```json
{
  "query": "åŒ—äº¬ä»Šå¤©å¤©æ°”"
}
```

**å“åº”ç¤ºä¾‹**
```json
{
  "success": true,
  "query": "åŒ—äº¬ä»Šå¤©å¤©æ°”",
  "results": [
    {
      "title": "åŒ—äº¬å¸‚å¤©æ°”é¢„æŠ¥",
      "url": "https://tianqi.moji.com/weather/china/beijing/beijing",
      "content": "åŒ—äº¬å¸‚ä»Šå¤©å®å†µï¼š-5åº¦æ™´...",
      "score": 0.9031,
      "publishedDate": ""
    }
  ]
}
```

**è¯´æ˜**
- éœ€è¦å·²å®Œæˆ Qwen OAuth è®¤è¯å¹¶å…·å¤‡æœ‰æ•ˆ `oauth_creds.json`
- Search ç»Ÿè®¡ä¸ Chat ç»Ÿè®¡ç‹¬ç«‹å±•ç¤º
- é…é¢æ˜¾ç¤ºå¯åœ¨ `gateway.yaml` çš„ `quota.search` ä¸­é…ç½®ï¼ˆ`0` è¡¨ç¤ºæ— é™åˆ¶ï¼Œä»…ç”¨äºè§‚æµ‹å±•ç¤ºï¼‰

## ğŸ“ è®¸å¯è¯
æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚
